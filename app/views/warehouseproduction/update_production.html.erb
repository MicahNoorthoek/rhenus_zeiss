<style>
.position {
  float: left;
}
</style>

<div class="warehousereceiptdetailsuniqueidentifier content-squish-screens" style="background-color: #f4f4f4; padding: 20px; border-left: 3px solid #000000;">
<h1 style="font-size: 30px; !important; padding-bottom: 30px;">Update Production</h1>

  <%= form_with model: @updateproduction, url: update_production_path, method: :post, local: true do |f| %>
    <%= f.hidden_field :production_identifier, value: @updateproduction.production_identifier %>
    <div class="row justify-content-center" style="text-align: center;">
      <div class="col-3">
        <div class="form-group">
          <%= f.label :spc, "Production Identifier", class: "position" %>
          <%= f.text_field :production_identifier, class: 'form-control', id: 'production_identifier', readonly: true %><br>
          <p id='select-production_identifier-error' style='float:left; display:none; font-size: 13px; margin-top: -20px !important;'>*Required<p>
        </div>
      </div>

      <div class="col-3">
        <div class="form-group" >
          <%= f.label :releasedate, "Release Date *", class: "position" %>
          <%= f.date_field :releasedate, class: 'form-control', id: 'releasedate' %><br>
          <p id='select-releasedate-error' style='float:left; display:none; font-size: 13px; margin-top: -20px !important;'>*Required<p>
        </div>
      </div>


      <div class="col-3">
        <div class="form-group">
          <%= f.label :process_type, "Process Type *", class: "position" %>
          <%= select_tag :process_type, options_for_select([@updateproduction.process_type] + @process.collect {|p| [p.process_type]}), { autofocus: true, class: "form-control mb-3", id: "processtype_select_dropdown", required: true } %><br>
          <p id='select-process_type-error' style='float:left; display:none; font-size: 13px; margin-top: -20px !important;'>*Required<p>
        </div>
      </div>


      <!-- Add a div for the submit button -->
      <div class="row">
        <div class="col-md-12 text-center">
          <div class='position-centerish' style='height:50px;'>
            <%= link_to 'Back', warehouse_production_path, class: "btn btn-light btn-sm btn-search", style: "width:25%; margin-right: 50px !important;" %>
            <%= f.submit 'Update Production', class: 'btn btn-sm btn-primary', style: "width:25%;" %>
          </div>
        </div>
      </div>

  <% end %>

</div>
<!-- END CARD BODY -->


</div>
<br>
<br>
<script>
  document.addEventListener("turbo:load", function () {
  const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
  const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))

  var buttons = document.querySelectorAll(".popoverBtn");

  buttons.forEach(function(button) {

    button.addEventListener("mouseover", function() {
      // Simulate a click when hovering over the button
      this.click();
    });

    button.addEventListener("mouseout", function() {
      this.click();
    });
  
  });
  });

  document.addEventListener("turbo:load", function () {
    const currentDate = new Date();
    const oneWeekAgo = new Date(currentDate);
    oneWeekAgo.setDate(currentDate.getDate() - 7);  
    const oneWeekLater = new Date(currentDate);
    oneWeekLater.setDate(currentDate.getDate() + 7); 

    const minDate = oneWeekAgo//.toISOString().split('T')[0];
    const maxDate = oneWeekLater//.toISOString().split('T')[0];

    $('#releasedate').attr('min', minDate);
    $('#releasedate').attr('max', maxDate);

    $("#releasedate").on("change", function() {
      var selectedDate = new Date(this.value);
      if (selectedDate < oneWeekAgo || selectedDate > oneWeekLater) {
        $("#select-releasedate-error").text("Please select a date within one week from today.").show();
        this.value = ''; 
      } else {
        $("#select-releasedate-error").hide();
      }
    });
  });



  document.addEventListener("turbo:load", function () {
    
    $("#up-arrow").hide()

    var errors_array = []

    var production_identifier  = $("#production_identifier").val()
    var releasedate = $("#releasedate").val()
    var process_type = $("#processtype_select_dropdown").val()

    if (production_identifier === null || production_identifier === undefined || production_identifier === '') {
      errors_array.push('production_identifier')
    }

    if (releasedate === null || releasedate === undefined || releasedate === '') {
      errors_array.push('releasedate');
    }

    if (process_type === null || process_type === undefined || process_type === '') {
      errors_array.push('process_type');
    }

    if (errors_array.length > 0) {
      $("input[type='submit']").prop("disabled", true);
    }
    checkError(errors_array)


    $("#production_identifier").on("change click keyup", function() {
      $('.element').hide();
      if (this.value !== null && this.value !== undefined && this.value !== '') {
        $("#select-production_identifier-error").hide().removeClass("text-danger criteria-display-smplbw");
        errors_array = errors_array.filter(item => item !== 'production_identifier');
        if (errors_array.length <= 0) {
          initiateValidate()
        }
        //checkError(errors_array)
      } else {
        if (errors_array.includes('production_identifier')) {
          checkError(errors_array)
        } else {
          errors_array.push('production_identifier')
          checkError(errors_array)
        }
      }
    })

    $("#releasedate").on("change click keyup", function() {// && this.value >= 1
      $('.element').hide();
      if (this.value !== null && this.value !== undefined && this.value !== '') {
        $("#select-releasedate-error").hide().removeClass("text-danger criteria-display-smplbw");
        errors_array = errors_array.filter(item => item !== 'releasedate');
        if (errors_array.length <= 0) {
          initiateValidate()
        }
        //checkError(errors_array)
      } else {
        errors_array.push('releasedate')
        checkError(errors_array)
      }
    })

    $("#processtype_select_dropdown").on("click keyup", function() {// && this.value >= 1
      $('.element').hide();
      if (this.value !== null && this.value !== undefined && this.value !== '') {
        $("#select-process_type-error").hide().removeClass("text-danger criteria-display-smplbw");
        errors_array = errors_array.filter(item => item !== 'process_type');
        if (errors_array.length <= 0) {
          initiateValidate()
        }
        //checkError(errors_array)
      } else {
        errors_array.push('process_type')
        checkError(errors_array)
      }
    })



    function checkError(errors_array) {
      //console.log(errors_array)
      if (errors_array.length <= 0) {
        $("input[type='submit']").prop("disabled", false);
        $("#select-production_identifier-error").hide()
        $("#select-releasedate-error").hide()
        $("#select-process_type-error").hide();
        $('.warehousereceiptdetailsuniqueidentifier').removeClass('progress-border-bad').addClass('progress-border-good');
        
      } else {
        $('.warehousereceiptdetailsuniqueidentifier').removeClass('progress-border-good').addClass('progress-border-bad');
        $("input[type='submit']").prop("disabled", true);
        for (error of errors_array) {

          switch (error) {
            case "production_identifier":
              $("#select-production_identifier-error").show().addClass("text-danger criteria-display-smplbw");
              break;
            case "releasedate":
              $("#select-releasedate-error").show().addClass("text-danger criteria-display-smplbw");
              break;
            case "process_type":
              $("#select-client-error").show().addClass("text-danger criteria-display-smplbw");
              break;
          }
        }
      }
    }

    function initiateValidate() {
      $("input[type='submit']").prop("disabled", false);
      $('.warehousereceiptdetailsuniqueidentifier').removeClass('progress-border-bad').addClass('progress-border-good');
    }

    
  });
</script>